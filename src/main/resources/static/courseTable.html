<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>课程表</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script type="text/javascript" src="./javascript/jquery.min.js"></script>
    <link rel="stylesheet" href="./layui/css/layui.css" media="all">
    <script type="text/javascript" src="./layui/layui.js"></script>
    <script type="text/javascript" src="./javascript/xlsx.full.min.js"></script>
    <style type="text/css">
        th {
            width: 70px;
            height: 80px;
            text-align: center;
        }

        td {
            width: 70px;
            height: 110px;
            text-align: center;
        }

        .number {
            width: 70px;
            height: 100px;
        }
    </style>

    <script>

        function GetQueryString(name) {
            let reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            let r = window.location.search.substr(1).match(reg);
            if (r != null) {
                return unescape(r[2]);
            }
            return null;
        }

        let type = GetQueryString("type");
        let typeId = GetQueryString("id");

        let layer;
        layui.use('layer', function(){
            layer = layui.layer;
        });

        $(document).ready(function () {
            $("#importBtn").click(function () {
                $("#import").click();
            });

            var url = "http://127.0.0.1:8088/course/query?type=" + type + "&typeId=" + typeId;
            $.get(url, function (data, status) {
                var ret = JSON.parse(JSON.stringify(data));
                if (ret.status == 1) {
                    layer.msg(ret.msg);
                } else {
                    $(".clean").html("")
                    $(".clean").css("background-color", "#ffffff");
                    JSON.parse(ret.data).forEach(course => {
                        // 周几
                        var day = course.dayOfWeek;
                        // 第几节
                        var number = course.classStart;
                        // 课程名
                        var text = course.name;
                        if (day == "1" && number == 1) {
                            $("#a1").html(text)
                            $("#a1").css("background-color", "#f2f2f2");
                        }
                        if (day == "1" && number == 2) {
                            $("#a2").html(text)
                            $("#a2").css("background-color", "#f2f2f2");
                        }
                        if (day == "1" && number == 3) {
                            $("#a3").html(text)
                            $("#a3").css("background-color", "#f2f2f2");
                        }
                        if (day == "1" && number == 4) {
                            $("#a4").html(text)
                            $("#a4").css("background-color", "#f2f2f2");
                        }
                        if (day == "1" && number == 5) {
                            $("#a5").html(text)
                            $("#a5").css("background-color", "#f2f2f2");
                        }
                        if (day == "1" && number == 6) {
                            $("#a6").html(text)
                            $("#a6").css("background-color", "#f2f2f2");
                        }

                        if (day == "2" && number == 1) {
                            $("#b1").html(text)
                            $("#b1").css("background-color", "#f2f2f2");
                        }
                        if (day == "2" && number == 2) {
                            $("#b2").html(text)
                            $("#b2").css("background-color", "#f2f2f2");
                        }
                        if (day == "2" && number == 3) {
                            $("#b3").html(text)
                            $("#b3").css("background-color", "#f2f2f2");
                        }
                        if (day == "2" && number == 4) {
                            $("#b4").html(text)
                            $("#b4").css("background-color", "#f2f2f2");
                        }
                        if (day == "2" && number == 5) {
                            $("#b5").html(text)
                            $("#b5").css("background-color", "#f2f2f2");
                        }
                        if (day == "2" && number == 6) {
                            $("#b6").html(text)
                            $("#b6").css("background-color", "#f2f2f2");
                        }

                        if (day == "3" && number == 1) {
                            $("#c1").html(text)
                            $("#c1").css("background-color", "#f2f2f2");
                        }
                        if (day == "3" && number == 2) {
                            $("#c2").html(text)
                            $("#c2").css("background-color", "#f2f2f2");
                        }
                        if (day == "3" && number == 3) {
                            $("#c3").html(text)
                            $("#c3").css("background-color", "#f2f2f2");
                        }
                        if (day == "3" && number == 4) {
                            $("#c4").html(text)
                            $("#c4").css("background-color", "#f2f2f2");
                        }
                        if (day == "3" && number == 5) {
                            $("#c5").html(text)
                            $("#c5").css("background-color", "#f2f2f2");
                        }
                        if (day == "3" && number == 6) {
                            $("#c6").html(text)
                            $("#c6").css("background-color", "#f2f2f2");
                        }

                        if (day == "4" && number == 1) {
                            $("#d1").html(text)
                            $("#d1").css("background-color", "#f2f2f2");
                        }
                        if (day == "4" && number == 2) {
                            $("#d2").html(text)
                            $("#d2").css("background-color", "#f2f2f2");
                        }
                        if (day == "4" && number == 3) {
                            $("#d3").html(text)
                            $("#d3").css("background-color", "#f2f2f2");
                        }
                        if (day == "4" && number == 4) {
                            $("#d4").html(text)
                            $("#d4").css("background-color", "#f2f2f2");
                        }
                        if (day == "4" && number == 5) {
                            $("#d5").html(text)
                            $("#d5").css("background-color", "#f2f2f2");
                        }
                        if (day == "4" && number == 6) {
                            $("#d6").html(text)
                            $("#d6").css("background-color", "#f2f2f2");
                        }

                        if (day == "5" && number == 1) {
                            $("#e1").html(text)
                            $("#e1").css("background-color", "#f2f2f2");
                        }
                        if (day == "5" && number == 2) {
                            $("#e2").html(text)
                            $("#e2").css("background-color", "#f2f2f2");
                        }
                        if (day == "5" && number == 3) {
                            $("#e3").html(text)
                            $("#e3").css("background-color", "#f2f2f2");
                        }
                        if (day == "5" && number == 4) {
                            $("#e4").html(text)
                            $("#e4").css("background-color", "#f2f2f2");
                        }
                        if (day == "5" && number == 5) {
                            $("#e5").html(text)
                            $("#e5").css("background-color", "#f2f2f2");
                        }
                        if (day == "5" && number == 6) {
                            $("#e6").html(text)
                            $("#e6").css("background-color", "#f2f2f2");
                        }

                        if (day == "6" && number == 1) {
                            $("#f1").html(text)
                            $("#f1").css("background-color", "#f2f2f2");
                        }
                        if (day == "6" && number == 2) {
                            $("#f2").html(text)
                            $("#f2").css("background-color", "#f2f2f2");
                        }
                        if (day == "6" && number == 3) {
                            $("#f3").html(text)
                            $("#f3").css("background-color", "#f2f2f2");
                        }
                        if (day == "6" && number == 4) {
                            $("#f4").html(text)
                            $("#f4").css("background-color", "#f2f2f2");
                        }
                        if (day == "6" && number == 5) {
                            $("#f5").html(text)
                            $("#f5").css("background-color", "#f2f2f2");
                        }
                        if (day == "6" && number == 6) {
                            $("#f6").html(text)
                            $("#f6").css("background-color", "#f2f2f2");
                        }

                        if (day == "7" && number == 1) {
                            $("#g1").html(text)
                            $("#g1").css("background-color", "#f2f2f2");
                        }
                        if (day == "7" && number == 2) {
                            $("#g2").html(text)
                            $("#g2").css("background-color", "#f2f2f2");
                        }
                        if (day == "7" && number == 3) {
                            $("#g3").html(text)
                            $("#g3").css("background-color", "#f2f2f2");
                        }
                        if (day == "7" && number == 4) {
                            $("#g4").html(text)
                            $("#g4").css("background-color", "#f2f2f2");
                        }
                        if (day == "7" && number == 5) {
                            $("#g5").html(text)
                            $("#g5").css("background-color", "#f2f2f2");
                        }
                        if (day == "7" && number == 6) {
                            $("#g6").html(text)
                            $("#g6").css("background-color", "#f2f2f2");
                        }
                    });
                }
            });
        });

        // 导入数据
        var wb;//读取完成的数据
        var rABS = false; //是否将文件读取为二进制字符串

        function importf(obj) {//导入

            if (!obj.files) {
                return;
            }
            var f = obj.files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                var data = e.target.result;
                if (rABS) {
                    wb = XLSX.read(btoa(fixdata(data)), {//手动转化
                        type: 'base64'
                    });
                } else {
                    wb = XLSX.read(data, {
                        type: 'binary'
                    });
                }
                //wb.SheetNames[0]是获取Sheets中第一个Sheet的名字
                //wb.Sheets[Sheet名]获取第一个Sheet的数据
                let courses = JSON.stringify(XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]));
                console.log(courses);

                $.post("http://127.0.0.1:8088/course/import", {
                    courses,
                    type,
                    typeId
                }, function (res) {
                    if (res.status === 0) {
                        location.reload();
                    } else {
                        layer.msg(res.msg)
                    }
                });

            };
            if (rABS) {
                reader.readAsArrayBuffer(f);
            } else {
                reader.readAsBinaryString(f);
            }
        }

    </script>
</head>

<body>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
    <legend>课程表</legend>
</fieldset>
<div class="layui-row">
    <div class="layui-btn-container" style="margin-left: 50px;">
        <a class="layui-btn layui-btn-sm" id="importBtn">导入课表</a>
        <input type="file" style="display: none" id="import" onchange="importf(this)">
    </div>
</div>
<div class="layui-row ">
    <div class="layui-col-md7" style="margin-left: 50px;">
        <table class="layui-table" lay-even="" lay-skin="">

            <thead>
            <tr style="text-align: center">
                <th></th>
                <th style="text-align: center">星期一</th>
                <th style="text-align: center">星期二</th>
                <th style="text-align: center">星期三</th>
                <th style="text-align: center">星期四</th>
                <th style="text-align: center">星期五</th>
                <th style="text-align: center">星期六</th>
                <th style="text-align: center">星期日</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td class="number">第一节<br>(8:00-10:00)</td>
                <td class="clean" id="a1"></td>
                <td class="clean" id="b1"></td>
                <td class="clean" id="c1"></td>
                <td class="clean" id="d1"></td>
                <td class="clean" id="e1"></td>
                <td class="clean" id="f1"></td>
                <td class="clean" id="g1"></td>

            </tr>
            <tr>
                <td class="number">第二节<br>(11:00-12:00)</td>
                <td class="clean" id="a2"></td>
                <td class="clean" id="b2"></td>
                <td class="clean" id="c2"></td>
                <td class="clean" id="d2"></td>
                <td class="clean" id="e2"></td>
                <td class="clean" id="f2"></td>
                <td class="clean" id="g2"></td>
            </tr>
            <tr>
                <td class="number">第三节<br>(13:00-15:00)</td>
                <td class="clean" id="a3"></td>
                <td class="clean" id="b3"></td>
                <td class="clean" id="c3"></td>
                <td class="clean" id="d3"></td>
                <td class="clean" id="e3"></td>
                <td class="clean" id="f3"></td>
                <td class="clean" id="g3"></td>
            </tr>
            <tr>
                <td class="number">第四节<br>(16:00-18:00)</td>
                <td class="clean" id="a4"></td>
                <td class="clean" id="b4"></td>
                <td class="clean" id="c4"></td>
                <td class="clean" id="d4"></td>
                <td class="clean" id="e4"></td>
                <td class="clean" id="f4"></td>
                <td class="clean" id="g4"></td>
            </tr>
            <tr>
                <td class="number">第五节<br>(19:00-20:00)</td>
                <td class="clean" id="a5"></td>
                <td class="clean" id="b5"></td>
                <td class="clean" id="c5"></td>
                <td class="clean" id="d5"></td>
                <td class="clean" id="e5"></td>
                <td class="clean" id="f5"></td>
                <td class="clean" id="g5"></td>
            </tr>
            <tr>
                <td class="number">第六节<br>(20:00-21:00)</td>
                <td class="clean" id="a6"></td>
                <td class="clean" id="b6"></td>
                <td class="clean" id="c6"></td>
                <td class="clean" id="d6"></td>
                <td class="clean" id="e6"></td>
                <td class="clean" id="f6"></td>
                <td class="clean" id="g6"></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</div>
</body>

</html>